<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2023a"><title>Handling errors from the API</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S3 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S4 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S5 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S6 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { color: rgb(33, 33, 33); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsErrorElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsErrorElement .diagnosticMessage-errorType {    overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsWarningElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsWarningElement .diagnosticMessage-warningType {    overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
/* Copyright 2015-2022 The MathWorks, Inc. *//* In this file, styles are not scoped to rtcContainer since they could be in the Dojo Tooltip */.diagnosticMessage-wrapper {    font-family: Menlo, Monaco, Consolas, "Courier New", monospace;    font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {    color: var(--mw-color-matlabWarning);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {    color: var(--mw-color-matlabWarning);    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType a {    color: var(--mw-color-matlabWarning) !important;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {    color: var(--mw-color-matlabErrors);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {    color: var(--mw-color-matlabErrors);    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType a {    color: var(--mw-color-matlabErrors) !important;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {    white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {    white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {    white-space: pre;    word-wrap:  initial;    min-height: 18px;    max-height: 550px;}
.embeddedOutputsTextElement .textElement,.embeddedOutputsVariableStringElement .textElement {    overflow: auto;}
.textElement,.rtcDataTipElement .textElement {    padding-top: 2px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {    min-height: 16px;}
.rightPaneElement .textElement {    padding-top: 2px;    padding-left: 9px;}
.S10 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S11 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Handling errors from the API</span></h1><div  class = 'S1'><span>When there is an error from the API, an 'ApiError' object is thrown. The ApiError object has  retriveable information about the error. The ApiError object is an extension of the MException object and contains all the fields from MException. </span></div><div  class = 'S1'><span>Additionall fields available are :</span></div><ul  class = 'S2'><li  class = 'S3'><span>Status </span></li><li  class = 'S3'><span>ApiErrorDetail </span></li><li  class = 'S3'><span>ResponseHeaders </span></li></ul><div  class = 'S1'><span>In the example below, we will use the SearchAPI to demonstrate an approach to handle a Rate Limiting error (429:TooManyRequests).</span></div><h2  class = 'S4'><span>Too Many Requests (429) Error</span></h2><div  class = 'S1'><span>The Too Many Requests (429)  happens when you exceed rate limit(s) specified by the API. In the case of this error, the </span><span style=' font-family: monospace;'>headers</span><span> in the response usually have additional details about the limits exceeded.</span></div><h3  class = 'S5'><span>Create multiple requests to cause rate limit error</span></h3><div  class = 'S1'><span>Generally, you might run into this error when you are quickly paginating through a series of requests</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >n = 1:50</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">try </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        [results, status, headers] = SearchApi.search;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        disp(</span><span style="color: rgb(167, 9, 245);">"Request Successful"</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">catch </span><span >ApiError</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(14, 0, 255);">if </span><span >ApiError.Status == matlab.net.http.StatusCode.TooManyRequests</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            disp(</span><span style="color: rgb(167, 9, 245);">"Rate Limit Exceeded"</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            ApiError</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            ApiError.ApiErrorDetail</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            </span><span style="color: rgb(14, 0, 255);">break</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div><div  class = 'S9'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="384C81C1" prevent-scroll="true" data-testid="output_0" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">Rate Limit Exceeded</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsVariableStringElement" uid="4988ADA2" prevent-scroll="true" data-testid="output_1" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="167" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><span class="variableNameElement" style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">ApiError = </span></div><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">  ApiError with properties:

             Status: TooManyRequests
     ApiErrorDetail: [1×1 ApiErrorDetail]
    ResponseHeaders: [1×18 matlab.net.http.HeaderField]
         identifier: 'Api:HttpError'
            message: 'HttpError:429 TooManyRequests'
              cause: {}
              stack: [21×1 struct]
         Correction: []
</div></div></div><div class="inlineElement eoOutputWrapper embeddedOutputsVariableStringElement" uid="C26D4E36" prevent-scroll="true" data-testid="output_2" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="94" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><span class="variableNameElement" style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">ans = </span></div><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">  ApiErrorDetail with properties:

    ErrorCode: "Too Many Requests"
      Message: "You have exceeded the limits allowed for API access."
      Details: "For more details, see the Retry-After response header, and then implement an exponential backoff for your requests."
</div></div></div></div></div></div><h3  class = 'S10'><span>Handle rate limit error</span></h3><div  class = 'S1'><span>In order to handle a rate limit error, we implement a wait until the required number of seconds as specified in the response has passed</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >n = 1:50</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">try</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        [results, status, headers] = SearchApi.search;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        disp(</span><span style="color: rgb(167, 9, 245);">"Request successful"</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">catch </span><span >ApiError</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Uncomment to see ApiError object</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% disp(ApiError);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(14, 0, 255);">if </span><span >ApiError.Status == matlab.net.http.StatusCode.TooManyRequests</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">% Uncomment to see error details </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">% disp(ApiError.ApiErrorDetail); </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">%We see in the error details to check Retry-After header, let's check the value.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           headers = ApiError.ResponseHeaders;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           retry = headers.getFields(</span><span style="color: rgb(167, 9, 245);">'Retry-After'</span><span >).Value;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">%Additionally, we can check the rate-limit type that was exceeded</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           limitExceededType = headers.getFields(</span><span style="color: rgb(167, 9, 245);">'X-RateLimit-Type'</span><span >).Value;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">% limitExceededType can either be PerMinute-Limit or PerDay-Limit</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">% After converting the retry value to the correct format, we divide</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">% by 1000 to convert from milliseconds to seconds</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           retry = int64(str2double(retry))/1000;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">%extract current time in epoch time</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           currentTimeInEpoch = convertTo(datetime(</span><span style="color: rgb(167, 9, 245);">'now'</span><span >,</span><span style="color: rgb(167, 9, 245);">'TimeZone'</span><span >,</span><span style="color: rgb(167, 9, 245);">'local'</span><span >),</span><span style="color: rgb(167, 9, 245);">'epochtime'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           </span><span style="color: rgb(0, 128, 19);">%calculate number of seconds to wait before making a request</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           secondsToWait = retry - currentTimeInEpoch;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           dispVal = </span><span style="color: rgb(167, 9, 245);">"Pausing for " </span><span >+ string(secondsToWait) + </span><span style="color: rgb(167, 9, 245);">" seconds"</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           disp(dispVal);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >           pause(secondsToWait)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >     </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            </span><span style="color: rgb(0, 128, 19);">% once the pause is completed, the requests are made again successfully </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div><div  class = 'S9'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="B8ED43A2" prevent-scroll="true" data-testid="output_3" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">Pausing for 21 seconds</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="58C7FF70" prevent-scroll="true" data-testid="output_4" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="445" data-hashorizontaloverflow="false" style="max-height: 456px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="742AAD17" prevent-scroll="true" data-testid="output_5" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">Pausing for 50 seconds</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="13849E69" prevent-scroll="true" data-testid="output_6" style="width: 1145px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="1115" data-previous-scroll-height="268" data-hashorizontaloverflow="false" style="max-height: 279px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful
Request successful</div></div></div></div></div><div  class = 'S11'><span></span></div><div  class = 'S1'></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Handling errors from the API
% When there is an error from the API, an 'ApiError' object is thrown. The ApiError 
% object has  retriveable information about the error. The ApiError object is 
% an extension of the MException object and contains all the fields from MException. 
% 
% Additionall fields available are :
%% 
% * Status 
% * ApiErrorDetail 
% * ResponseHeaders 
%% 
% In the example below, we will use the SearchAPI to demonstrate an approach 
% to handle a Rate Limiting error (429:TooManyRequests).
%% Too Many Requests (429) Error
% The Too Many Requests (429)  happens when you exceed rate limit(s) specified 
% by the API. In the case of this error, the |headers| in the response usually 
% have additional details about the limits exceeded.
% Create multiple requests to cause rate limit error
% Generally, you might run into this error when you are quickly paginating through 
% a series of requests

for n = 1:50
    try 
        [results, status, headers] = SearchApi.search;
        disp("Request Successful")
    catch ApiError
        if ApiError.Status == matlab.net.http.StatusCode.TooManyRequests
            disp("Rate Limit Exceeded")
            ApiError
            ApiError.ApiErrorDetail
            break;
        end
    end
end
% Handle rate limit error
% In order to handle a rate limit error, we implement a wait until the required 
% number of seconds as specified in the response has passed

for n = 1:50
    try
        [results, status, headers] = SearchApi.search;
        disp("Request successful")
    catch ApiError
        % Uncomment to see ApiError object
        % disp(ApiError);
        if ApiError.Status == matlab.net.http.StatusCode.TooManyRequests
           % Uncomment to see error details 
           % disp(ApiError.ApiErrorDetail); 
           
           %We see in the error details to check Retry-After header, let's check the value.
           headers = ApiError.ResponseHeaders;
           retry = headers.getFields('Retry-After').Value;
           
           %Additionally, we can check the rate-limit type that was exceeded
           limitExceededType = headers.getFields('X-RateLimit-Type').Value;
           % limitExceededType can either be PerMinute-Limit or PerDay-Limit
    
    
           % After converting the retry value to the correct format, we divide
           % by 1000 to convert from milliseconds to seconds
           retry = int64(str2double(retry))/1000;
    
           %extract current time in epoch time
           currentTimeInEpoch = convertTo(datetime('now','TimeZone','local'),'epochtime');
    
           %calculate number of seconds to wait before making a request
           secondsToWait = retry - currentTimeInEpoch;
           dispVal = "Pausing for " + string(secondsToWait) + " seconds";
           disp(dispVal);
           pause(secondsToWait)
     
            % once the pause is completed, the requests are made again successfully 
        end
    end
end
%% 
% 
% 
%
##### SOURCE END #####
-->
</div></body></html>